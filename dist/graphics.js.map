{"version":3,"sources":["../src/graphics.js"],"names":["Sunburst","selector","done","self","width","height","radius","Math","min","panelId","x","d3","scale","linear","range","PI","y","sqrt","color","category20c","init","select","remove","svg","append","attr","partition","layout","sort","value","d","arc","startAngle","max","endAngle","dx","innerRadius","outerRadius","dy","node","json","error","root","path","datum","selectAll","data","nodes","enter","style","children","parent","name","on","click","each","stash","change","size","transition","duration","attrTween","arcTweenData","arcTweenZoom","frameElement","x0","dx0","a","i","oi","interpolate","tween","t","b","xd","domain","yd","yr","window"],"mappings":"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","file":"graphics.js","sourcesContent":["var Sunburst = function() {\n  this.selector = \".sun\";\n  this.done = false;\n  var self = this;\n  this.width = 960;\n  this.height = 700;\n  this.radius = Math.min(this.width, this.height) / 2;\n  this.panelId = 'panel';\n\n  var x = d3.scale.linear()\n      .range([0, 2 * Math.PI]);\n\n  var y = d3.scale.sqrt()\n      .range([0, this.radius]);\n\n  var color = d3.scale.category20c();\n  this.init = function(){\n  d3.select(self.panelId).remove();\n\n  var svg = d3.select(self.selector).append(self.panelId).append(\"svg\")\n      .attr(\"width\", self.width)\n      .attr(\"height\", self.height)\n    .append(\"g\")\n      .attr(\"transform\", \"translate(\" + self.width / 2 + \",\" + (self.height / 2 + 10) + \")\");\n\n  var partition = d3.layout.partition()\n      .sort(null)\n      .value(function(d) { return 1; });\n\n  var arc = d3.svg.arc()\n      .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })\n      .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })\n      .innerRadius(function(d) { return Math.max(0, y(d.y)); })\n      .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });\n\n  // Keep track of the node that is currently being displayed as the root.\n  var node;\n\n  d3.json(\"public/plugins/grafana-sunburst-panel/flare.json\", function(error, root) {\n\n    node = root;\n    var path = svg.datum(root).selectAll(\"path\")\n        .data(partition.nodes)\n      .enter().append(\"path\")\n        .attr(\"d\", arc)\n        .style(\"fill\", function(d) { return color((d.children ? d : d.parent).name); })\n        .on(\"click\", click)\n        .each(stash);\n\n    d3.selectAll(\"input\").on(\"change\", function change() {\n      var value = this.value === \"count\"\n          ? function() { return 1; }\n          : function(d) { return d.size; };\n\n      path\n          .data(partition.value(value).nodes)\n        .transition()\n          .duration(1000)\n          .attrTween(\"d\", arcTweenData);\n    });\n\n    function click(d) {\n      node = d;\n      path.transition()\n        .duration(1000)\n        .attrTween(\"d\", arcTweenZoom(d));\n    }\n  });\n\n  d3.select(self.frameElement).style(\"height\", self.height + \"px\");\n\n  // Setup for switching data: stash the old values for transition.\n  function stash(d) {\n    d.x0 = d.x;\n    d.dx0 = d.dx;\n  }\n\n  // When switching data: interpolate the arcs in data space.\n  function arcTweenData(a, i) {\n    var oi = d3.interpolate({x: a.x0, dx: a.dx0}, a);\n    function tween(t) {\n      var b = oi(t);\n      a.x0 = b.x;\n      a.dx0 = b.dx;\n      return arc(b);\n    }\n    if (i == 0) {\n     // If we are on the first arc, adjust the x domain to match the root node\n     // at the current zoom level. (We only need to do this once.)\n      var xd = d3.interpolate(x.domain(), [node.x, node.x + node.dx]);\n      return function(t) {\n        x.domain(xd(t));\n        return tween(t);\n      };\n    } else {\n      return tween;\n    }\n  }\n\n  // When zooming: interpolate the scales.\n  function arcTweenZoom(d) {\n    var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),\n        yd = d3.interpolate(y.domain(), [d.y, 1]),\n        yr = d3.interpolate(y.range(), [d.y ? 20 : 0, self.radius]);\n    return function(d, i) {\n      return i\n          ? function(t) { return arc(d); }\n          : function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); return arc(d); };\n    };\n  }\n  this.done = true;\n  }\n}\nwindow.Sunburst = Sunburst;\n"]}